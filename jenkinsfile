pipeline {
    agent {
        docker {
            image 'ppodgorsek/robot-framework'
            args '-u root -v /tmp/.cache:/root/.cache'
        }
    }

    stages {
               stage('Install Dependencies') {
            steps {
                sh 'pip install --user -r requirements.txt --no-cache-dir'
             }
        }

        stage('Run Tests') {
            steps {
                script {
                    sh 'robot --outputdir ./results demo.robot'
                }
            }
        }
    }
    
    post {
                always {
                        

                        robot(  outputPath: ".",
                                passThreshold: 90.0,
                                unstableThreshold: 70.0,//le seuil des test qui sont pas unstable qui peuvent pass√©
                                disableArchiveOutput: true,
                                outputFileName: "output.xml",
                                logFileName: 'log.html',
                                reportFileName: 'report.html',
                                countSkippedTests: true,    // Optional, defaults to false
                                otherFiles: 'screenshot-*.png'
)
                    
                }
            }
}
